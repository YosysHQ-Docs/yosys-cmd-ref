<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

      <title>7. The Verilog and AST frontends</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="_static/yosyshq.css" type="text/css" />
          <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
      <link rel="shortcut icon" href="_static/favico.png"/>
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="8. Optimizations" href="CHAPTER_Optimize.html" />
  <link rel="prev" title="6. Programming Yosys extensions" href="CHAPTER_Prog.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <img class="logo" src="_static/logo.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="index.html#yosys-manual"
         class="nav-link  router-link-active">
         Manual
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#yosys-manual"
         class="nav-link ">
         Appendix
      </a>
    </div>
  
    <div class="nav-item">
      <a href="cmd_ref.html#command-line-reference"
         class="nav-link ">
         Command reference
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://yosyshq.readthedocs.io"
        class="nav-link external">
          YosysHQ Docs <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://blog.yosyshq.com"
        class="nav-link external">
          Blog <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://www.yosyshq.com"
        class="nav-link external">
          Website <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="index.html#yosys-manual"
         class="nav-link  router-link-active">
         Manual
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#yosys-manual"
         class="nav-link ">
         Appendix
      </a>
    </div>
  
    <div class="nav-item">
      <a href="cmd_ref.html#command-line-reference"
         class="nav-link ">
         Command reference
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://yosyshq.readthedocs.io"
        class="nav-link external">
          YosysHQ Docs <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://blog.yosyshq.com"
        class="nav-link external">
          Blog <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://www.yosyshq.com"
        class="nav-link external">
          Website <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#yosys-manual">Manual</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Intro.html" class="reference internal ">Introduction</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Basics.html" class="reference internal ">Basic principles</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Approach.html" class="reference internal ">Approach</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Overview.html" class="reference internal ">Implementation overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_CellLib.html" class="reference internal ">Internal cell library</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Prog.html" class="reference internal ">Programming Yosys extensions</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">The Verilog and AST frontends</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#transforming-verilog-to-ast" class="reference internal">Transforming Verilog to AST</a></li>
                
                  <li class="toctree-l2"><a href="#transforming-ast-to-rtlil" class="reference internal">Transforming AST to RTLIL</a></li>
                
                  <li class="toctree-l2"><a href="#synthesizing-verilog-always-blocks" class="reference internal">Synthesizing Verilog always blocks</a></li>
                
                  <li class="toctree-l2"><a href="#synthesizing-verilog-arrays" class="reference internal">Synthesizing Verilog arrays</a></li>
                
                  <li class="toctree-l2"><a href="#synthesizing-parametric-designs" class="reference internal">Synthesizing parametric designs</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Optimize.html" class="reference internal ">Optimizations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="CHAPTER_Techmap.html" class="reference internal ">Technology mapping</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#yosys-manual">Appendix</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="appendix/CHAPTER_Auxlibs.html" class="reference internal ">Auxiliary libraries</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="appendix/CHAPTER_Auxprogs.html" class="reference internal ">Auxiliary programs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="appendix/CHAPTER_TextRtlil.html" class="reference internal ">RTLIL text representation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="appendix/APPNOTE_010_Verilog_to_BLIF.html" class="reference internal ">010: Converting Verilog to BLIF page</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="appendix/APPNOTE_011_Design_Investigation.html" class="reference internal ">011: Interactive design investigation page</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="appendix/APPNOTE_012_Verilog_to_BTOR.html" class="reference internal ">012: Converting Verilog to BTOR page</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="bib.html" class="reference internal ">Literature references</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="cmd_ref.html#command-line-reference">Command reference</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="cmd/abc.html" class="reference internal ">abc - use ABC for technology mapping</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/abc9.html" class="reference internal ">abc9 - use ABC9 for technology mapping</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/abc9_exe.html" class="reference internal ">abc9_exe - use ABC9 for technology mapping</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/abc9_ops.html" class="reference internal ">abc9_ops - helper functions for ABC9</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/add.html" class="reference internal ">add - add objects to the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/aigmap.html" class="reference internal ">aigmap - map logic to and-inverter-graph circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/alumacc.html" class="reference internal ">alumacc - extract ALU and MACC cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/anlogic_eqn.html" class="reference internal ">anlogic_eqn - Anlogic: Calculate equations for luts</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/anlogic_fixcarry.html" class="reference internal ">anlogic_fixcarry - Anlogic: fix carry chain</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/assertpmux.html" class="reference internal ">assertpmux - adds asserts for parallel muxes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/async2sync.html" class="reference internal ">async2sync - convert async FF inputs to sync circuits</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/attrmap.html" class="reference internal ">attrmap - renaming attributes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/attrmvcp.html" class="reference internal ">attrmvcp - move or copy attributes from wires to driving cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/autoname.html" class="reference internal ">autoname - automatically assign names to objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/blackbox.html" class="reference internal ">blackbox - convert modules into blackbox modules</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/bmuxmap.html" class="reference internal ">bmuxmap - transform $bmux cells to trees of $mux cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/bugpoint.html" class="reference internal ">bugpoint - minimize testcases</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/cd.html" class="reference internal ">cd - a shortcut for ‘select -module <name>’</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/check.html" class="reference internal ">check - check for obvious problems in the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/chformal.html" class="reference internal ">chformal - change formal constraints of the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/chparam.html" class="reference internal ">chparam - re-evaluate modules with new parameters</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/chtype.html" class="reference internal ">chtype - change type of cells in the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/clean.html" class="reference internal ">clean - remove unused cells and wires</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/clean_zerowidth.html" class="reference internal ">clean_zerowidth - clean zero-width connections from the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/clk2fflogic.html" class="reference internal ">clk2fflogic - convert clocked FFs to generic $ff cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/clkbufmap.html" class="reference internal ">clkbufmap - insert clock buffers on clock networks</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/connect.html" class="reference internal ">connect - create or remove connections</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/connect_rpc.html" class="reference internal ">connect_rpc - connect to RPC frontend</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/connwrappers.html" class="reference internal ">connwrappers - match width of input-output port pairs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/coolrunner2_fixup.html" class="reference internal ">coolrunner2_fixup - insert necessary buffer cells for CoolRunner-II architecture</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/coolrunner2_sop.html" class="reference internal ">coolrunner2_sop - break $sop cells into ANDTERM/ORTERM cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/copy.html" class="reference internal ">copy - copy modules in the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/cover.html" class="reference internal ">cover - print code coverage counters</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/cutpoint.html" class="reference internal ">cutpoint - adds formal cut points to the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/debug.html" class="reference internal ">debug - run command with debug log messages enabled</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/delete.html" class="reference internal ">delete - delete objects in the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/deminout.html" class="reference internal ">deminout - demote inout ports to input or output</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/demuxmap.html" class="reference internal ">demuxmap - transform $demux cells to $eq + $mux cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/design.html" class="reference internal ">design - save, restore and reset current design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/dffinit.html" class="reference internal ">dffinit - set INIT param on FF cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/dfflegalize.html" class="reference internal ">dfflegalize - convert FFs to types supported by the target</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/dfflibmap.html" class="reference internal ">dfflibmap - technology mapping of flip-flops</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/dffunmap.html" class="reference internal ">dffunmap - unmap clock enable and synchronous reset from FFs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/dump.html" class="reference internal ">dump - print parts of the design in RTLIL format</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/echo.html" class="reference internal ">echo - turning echoing back of commands on and off</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ecp5_gsr.html" class="reference internal ">ecp5_gsr - ECP5: handle GSR</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/edgetypes.html" class="reference internal ">edgetypes - list all types of edges in selection</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/efinix_fixcarry.html" class="reference internal ">efinix_fixcarry - Efinix: fix carry chain</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_add.html" class="reference internal ">equiv_add - add a $equiv cell</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_induct.html" class="reference internal ">equiv_induct - proving $equiv cells using temporal induction</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_make.html" class="reference internal ">equiv_make - prepare a circuit for equivalence checking</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_mark.html" class="reference internal ">equiv_mark - mark equivalence checking regions</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_miter.html" class="reference internal ">equiv_miter - extract miter from equiv circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_opt.html" class="reference internal ">equiv_opt - prove equivalence for optimized circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_purge.html" class="reference internal ">equiv_purge - purge equivalence checking module</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_remove.html" class="reference internal ">equiv_remove - remove $equiv cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_simple.html" class="reference internal ">equiv_simple - try proving simple $equiv instances</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_status.html" class="reference internal ">equiv_status - print status of equivalent checking module</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/equiv_struct.html" class="reference internal ">equiv_struct - structural equivalence checking</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/eval.html" class="reference internal ">eval - evaluate the circuit given an input</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/exec.html" class="reference internal ">exec - execute commands in the operating system shell</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/expose.html" class="reference internal ">expose - convert internal signals to module ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/extract.html" class="reference internal ">extract - find subcircuits and replace them with cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/extract_counter.html" class="reference internal ">extract_counter - Extract GreenPak4 counter cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/extract_fa.html" class="reference internal ">extract_fa - find and extract full/half adders</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/extract_reduce.html" class="reference internal ">extract_reduce - converts gate chains into $reduce_* cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/extractinv.html" class="reference internal ">extractinv - extract explicit inverter cells for invertible cell pins</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/flatten.html" class="reference internal ">flatten - flatten design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/flowmap.html" class="reference internal ">flowmap - pack LUTs with FlowMap</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fmcombine.html" class="reference internal ">fmcombine - combine two instances of a cell into one</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fminit.html" class="reference internal ">fminit - set init values/sequences for formal</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/formalff.html" class="reference internal ">formalff - prepare FFs for formal</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/freduce.html" class="reference internal ">freduce - perform functional reduction</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm.html" class="reference internal ">fsm - extract and optimize finite state machines</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_detect.html" class="reference internal ">fsm_detect - finding FSMs in design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_expand.html" class="reference internal ">fsm_expand - expand FSM cells by merging logic into it</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_export.html" class="reference internal ">fsm_export - exporting FSMs to KISS2 files</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_extract.html" class="reference internal ">fsm_extract - extracting FSMs in design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_info.html" class="reference internal ">fsm_info - print information on finite state machines</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_map.html" class="reference internal ">fsm_map - mapping FSMs to basic logic</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_opt.html" class="reference internal ">fsm_opt - optimize finite state machines</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fsm_recode.html" class="reference internal ">fsm_recode - recoding finite state machines</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/fst2tb.html" class="reference internal ">fst2tb - generate testbench out of fst file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/gatemate_foldinv.html" class="reference internal ">gatemate_foldinv - fold inverters into Gatemate LUT trees</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/glift.html" class="reference internal ">glift - create GLIFT models and optimization problems</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/greenpak4_dffinv.html" class="reference internal ">greenpak4_dffinv - merge greenpak4 inverters and DFF/latches</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/help.html" class="reference internal ">help - display help messages</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/hierarchy.html" class="reference internal ">hierarchy - check, expand and clean up design hierarchy</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/hilomap.html" class="reference internal ">hilomap - technology mapping of constant hi- and/or lo-drivers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/history.html" class="reference internal ">history - show last interactive commands</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ice40_braminit.html" class="reference internal ">ice40_braminit - iCE40: perform SB_RAM40_4K initialization from file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ice40_dsp.html" class="reference internal ">ice40_dsp - iCE40: map multipliers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ice40_opt.html" class="reference internal ">ice40_opt - iCE40: perform simple optimizations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ice40_wrapcarry.html" class="reference internal ">ice40_wrapcarry - iCE40: wrap carries</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/insbuf.html" class="reference internal ">insbuf - insert buffer cells for connected wires</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/iopadmap.html" class="reference internal ">iopadmap - technology mapping of i/o pads (or buffers)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/jny.html" class="reference internal ">jny - write design and metadata</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/json.html" class="reference internal ">json - write design in JSON format</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/log.html" class="reference internal ">log - print text and log files</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/logger.html" class="reference internal ">logger - set logger properties</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ls.html" class="reference internal ">ls - list modules or objects in modules</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/ltp.html" class="reference internal ">ltp - print longest topological path</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/lut2mux.html" class="reference internal ">lut2mux - convert $lut to $_MUX_</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/maccmap.html" class="reference internal ">maccmap - mapping macc cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory.html" class="reference internal ">memory - translate memories to basic cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_bmux2rom.html" class="reference internal ">memory_bmux2rom - convert muxes to ROMs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_bram.html" class="reference internal ">memory_bram - map memories to block rams</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_collect.html" class="reference internal ">memory_collect - creating multi-port memory cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_dff.html" class="reference internal ">memory_dff - merge input/output DFFs into memory read ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_libmap.html" class="reference internal ">memory_libmap - map memories to cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_map.html" class="reference internal ">memory_map - translate multiport memories to basic cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_memx.html" class="reference internal ">memory_memx - emulate vlog sim behavior for mem ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_narrow.html" class="reference internal ">memory_narrow - split up wide memory ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_nordff.html" class="reference internal ">memory_nordff - extract read port FFs from memories</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_share.html" class="reference internal ">memory_share - consolidate memory ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/memory_unpack.html" class="reference internal ">memory_unpack - unpack multi-port memory cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/miter.html" class="reference internal ">miter - automatically create a miter circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/mutate.html" class="reference internal ">mutate - generate or apply design mutations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/muxcover.html" class="reference internal ">muxcover - cover trees of MUX cells with wider MUXes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/muxpack.html" class="reference internal ">muxpack - $mux/$pmux cascades to $pmux</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/nlutmap.html" class="reference internal ">nlutmap - map to LUTs of different sizes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/onehot.html" class="reference internal ">onehot - optimize $eq cells for onehot signals</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt.html" class="reference internal ">opt - perform simple optimizations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_clean.html" class="reference internal ">opt_clean - remove unused cells and wires</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_demorgan.html" class="reference internal ">opt_demorgan - Optimize reductions with DeMorgan equivalents</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_dff.html" class="reference internal ">opt_dff - perform DFF optimizations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_expr.html" class="reference internal ">opt_expr - perform const folding and simple expression rewriting</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_ffinv.html" class="reference internal ">opt_ffinv - push inverters through FFs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_lut.html" class="reference internal ">opt_lut - optimize LUT cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_lut_ins.html" class="reference internal ">opt_lut_ins - discard unused LUT inputs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_mem.html" class="reference internal ">opt_mem - optimize memories</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_mem_feedback.html" class="reference internal ">opt_mem_feedback - convert memory read-to-write port feedback paths to write enables</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_mem_priority.html" class="reference internal ">opt_mem_priority - remove priority relations between write ports that can never collide</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_mem_widen.html" class="reference internal ">opt_mem_widen - optimize memories where all ports are wide</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_merge.html" class="reference internal ">opt_merge - consolidate identical cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_muxtree.html" class="reference internal ">opt_muxtree - eliminate dead trees in multiplexer trees</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_reduce.html" class="reference internal ">opt_reduce - simplify large MUXes and AND/OR gates</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/opt_share.html" class="reference internal ">opt_share - merge mutually exclusive cells of the same type that share an input signal</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/paramap.html" class="reference internal ">paramap - renaming cell parameters</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/peepopt.html" class="reference internal ">peepopt - collection of peephole optimizers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/plugin.html" class="reference internal ">plugin - load and list loaded plugins</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/pmux2shiftx.html" class="reference internal ">pmux2shiftx - transform $pmux cells to $shiftx cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/pmuxtree.html" class="reference internal ">pmuxtree - transform $pmux cells to trees of $mux cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/portlist.html" class="reference internal ">portlist - list (top-level) ports</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/prep.html" class="reference internal ">prep - generic synthesis script</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/printattrs.html" class="reference internal ">printattrs - print attributes of selected objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc.html" class="reference internal ">proc - translate processes to netlists</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_arst.html" class="reference internal ">proc_arst - detect asynchronous resets</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_clean.html" class="reference internal ">proc_clean - remove empty parts of processes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_dff.html" class="reference internal ">proc_dff - extract flip-flops from processes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_dlatch.html" class="reference internal ">proc_dlatch - extract latches from processes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_init.html" class="reference internal ">proc_init - convert initial block to init attributes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_memwr.html" class="reference internal ">proc_memwr - extract memory writes from processes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_mux.html" class="reference internal ">proc_mux - convert decision trees to multiplexers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_prune.html" class="reference internal ">proc_prune - remove redundant assignments</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_rmdead.html" class="reference internal ">proc_rmdead - eliminate dead trees in decision trees</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/proc_rom.html" class="reference internal ">proc_rom - convert switches to ROMs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/qbfsat.html" class="reference internal ">qbfsat - solve a 2QBF-SAT problem in the circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/qwp.html" class="reference internal ">qwp - quadratic wirelength placer</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read.html" class="reference internal ">read - load HDL designs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_aiger.html" class="reference internal ">read_aiger - read AIGER file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_blif.html" class="reference internal ">read_blif - read BLIF file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_ilang.html" class="reference internal ">read_ilang - (deprecated) alias of read_rtlil</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_json.html" class="reference internal ">read_json - read JSON file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_liberty.html" class="reference internal ">read_liberty - read cells from liberty file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_rtlil.html" class="reference internal ">read_rtlil - read modules from RTLIL file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/read_verilog.html" class="reference internal ">read_verilog - read modules from Verilog file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/rename.html" class="reference internal ">rename - rename object in the design</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/rmports.html" class="reference internal ">rmports - remove module ports with no connections</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/sat.html" class="reference internal ">sat - solve a SAT problem in the circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/scatter.html" class="reference internal ">scatter - add additional intermediate nets</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/scc.html" class="reference internal ">scc - detect strongly connected components (logic loops)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/scratchpad.html" class="reference internal ">scratchpad - get/set values in the scratchpad</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/script.html" class="reference internal ">script - execute commands from file or wire</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/select.html" class="reference internal ">select - modify and view the list of selected objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/setattr.html" class="reference internal ">setattr - set/unset attributes on objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/setparam.html" class="reference internal ">setparam - set/unset parameters on objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/setundef.html" class="reference internal ">setundef - replace undef values with defined constants</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/share.html" class="reference internal ">share - perform sat-based resource sharing</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/shell.html" class="reference internal ">shell - enter interactive command mode</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/show.html" class="reference internal ">show - generate schematics using graphviz</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/shregmap.html" class="reference internal ">shregmap - map shift registers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/sim.html" class="reference internal ">sim - simulate the circuit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/simplemap.html" class="reference internal ">simplemap - mapping simple coarse-grain cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/splice.html" class="reference internal ">splice - create explicit splicing cells</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/splitnets.html" class="reference internal ">splitnets - split up multi-bit nets</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/sta.html" class="reference internal ">sta - perform static timing analysis</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/stat.html" class="reference internal ">stat - print some statistics</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/submod.html" class="reference internal ">submod - moving part of a module to a new submodule</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/supercover.html" class="reference internal ">supercover - add hi/lo cover cells for each wire bit</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth.html" class="reference internal ">synth - generic synthesis script</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_achronix.html" class="reference internal ">synth_achronix - synthesis for Acrhonix Speedster22i FPGAs.</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_anlogic.html" class="reference internal ">synth_anlogic - synthesis for Anlogic FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_coolrunner2.html" class="reference internal ">synth_coolrunner2 - synthesis for Xilinx Coolrunner-II CPLDs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_easic.html" class="reference internal ">synth_easic - synthesis for eASIC platform</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_ecp5.html" class="reference internal ">synth_ecp5 - synthesis for ECP5 FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_efinix.html" class="reference internal ">synth_efinix - synthesis for Efinix FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_gatemate.html" class="reference internal ">synth_gatemate - synthesis for Cologne Chip GateMate FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_gowin.html" class="reference internal ">synth_gowin - synthesis for Gowin FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_greenpak4.html" class="reference internal ">synth_greenpak4 - synthesis for GreenPAK4 FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_ice40.html" class="reference internal ">synth_ice40 - synthesis for iCE40 FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_intel.html" class="reference internal ">synth_intel - synthesis for Intel (Altera) FPGAs.</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_intel_alm.html" class="reference internal ">synth_intel_alm - synthesis for ALM-based Intel (Altera) FPGAs.</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_machxo2.html" class="reference internal ">synth_machxo2 - synthesis for MachXO2 FPGAs. This work is experimental.</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_nexus.html" class="reference internal ">synth_nexus - synthesis for Lattice Nexus FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_quicklogic.html" class="reference internal ">synth_quicklogic - Synthesis for QuickLogic FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_sf2.html" class="reference internal ">synth_sf2 - synthesis for SmartFusion2 and IGLOO2 FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/synth_xilinx.html" class="reference internal ">synth_xilinx - synthesis for Xilinx FPGAs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/tcl.html" class="reference internal ">tcl - execute a TCL script file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/techmap.html" class="reference internal ">techmap - generic technology mapper</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/tee.html" class="reference internal ">tee - redirect command output to file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/test_abcloop.html" class="reference internal ">test_abcloop - automatically test handling of loops in abc command</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/test_autotb.html" class="reference internal ">test_autotb - generate simple test benches</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/test_cell.html" class="reference internal ">test_cell - automatically test the implementation of a cell type</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/test_pmgen.html" class="reference internal ">test_pmgen - test pass for pmgen</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/torder.html" class="reference internal ">torder - print cells in topological order</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/trace.html" class="reference internal ">trace - redirect command output to file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/tribuf.html" class="reference internal ">tribuf - infer tri-state buffers</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/uniquify.html" class="reference internal ">uniquify - create unique copies of modules</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/verific.html" class="reference internal ">verific - load Verilog and VHDL designs using Verific</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/verilog_defaults.html" class="reference internal ">verilog_defaults - set default options for read_verilog</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/verilog_defines.html" class="reference internal ">verilog_defines - define and undefine verilog defines</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/wbflip.html" class="reference internal ">wbflip - flip the whitebox attribute</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/wreduce.html" class="reference internal ">wreduce - reduce the word size of operations if possible</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_aiger.html" class="reference internal ">write_aiger - write design to AIGER file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_blif.html" class="reference internal ">write_blif - write design to BLIF file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_btor.html" class="reference internal ">write_btor - write design to BTOR file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_cxxrtl.html" class="reference internal ">write_cxxrtl - convert design to C++ RTL simulation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_edif.html" class="reference internal ">write_edif - write design to EDIF netlist file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_file.html" class="reference internal ">write_file - write a text to a file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_firrtl.html" class="reference internal ">write_firrtl - write design to a FIRRTL file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_ilang.html" class="reference internal ">write_ilang - (deprecated) alias of write_rtlil</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_intersynth.html" class="reference internal ">write_intersynth - write design to InterSynth netlist file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_jny.html" class="reference internal ">write_jny - generate design metadata</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_json.html" class="reference internal ">write_json - write design to a JSON file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_rtlil.html" class="reference internal ">write_rtlil - write design to RTLIL file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_simplec.html" class="reference internal ">write_simplec - convert design to simple C code</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_smt2.html" class="reference internal ">write_smt2 - write design to SMT-LIBv2 file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_smv.html" class="reference internal ">write_smv - write design to SMV file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_spice.html" class="reference internal ">write_spice - write design to SPICE netlist file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_table.html" class="reference internal ">write_table - write design as connectivity table</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_verilog.html" class="reference internal ">write_verilog - write design to Verilog file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/write_xaiger.html" class="reference internal ">write_xaiger - write design to XAIGER file</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/xilinx_dffopt.html" class="reference internal ">xilinx_dffopt - Xilinx: optimize FF control signal usage</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/xilinx_dsp.html" class="reference internal ">xilinx_dsp - Xilinx: pack resources into DSPs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/xilinx_srl.html" class="reference internal ">xilinx_srl - Xilinx shift register extraction</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd/zinit.html" class="reference internal ">zinit - add inverters so all FF are zero-initialized</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li><span class="section-number">7. </span>The Verilog and AST frontends</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="CHAPTER_Prog.html"
       title="previous chapter">← <span class="section-number">6. </span>Programming Yosys extensions</a>
  </li>
  <li class="next">
    <a href="CHAPTER_Optimize.html"
       title="next chapter"><span class="section-number">8. </span>Optimizations →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="the-verilog-and-ast-frontends">
<span id="chapter-verilog"></span><h1><span class="section-number">7. </span>The Verilog and AST frontends<a class="headerlink" href="#the-verilog-and-ast-frontends" title="Permalink to this heading">¶</a></h1>
<p>This chapter provides an overview of the implementation of the Yosys Verilog and
AST frontends. The Verilog frontend reads Verilog-2005 code and creates an
abstract syntax tree (AST) representation of the input. This AST representation
is then passed to the AST frontend that converts it to RTLIL data, as
illustrated in <a class="reference internal" href="#fig-verilog-flow"><span class="std std-numref">Fig. 7.1</span></a>.</p>
<figure class="align-default" id="fig-verilog-flow">
<img alt="_images/verilog_flow.svg" class="width-helper" src="_images/verilog_flow.svg" /><figcaption>
<p><span class="caption-number">Fig. 7.1 </span><span class="caption-text">Simplified Verilog to RTLIL data flow</span><a class="headerlink" href="#fig-verilog-flow" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="transforming-verilog-to-ast">
<h2><span class="section-number">7.1. </span>Transforming Verilog to AST<a class="headerlink" href="#transforming-verilog-to-ast" title="Permalink to this heading">¶</a></h2>
<p>The Verilog frontend converts the Verilog sources to an internal AST
representation that closely resembles the structure of the original
Verilog code. The Verilog frontend consists of three components, the
Preprocessor, the Lexer and the Parser.</p>
<p>The source code to the Verilog frontend can be found in
frontends/verilog/ in the Yosys source tree.</p>
<section id="the-verilog-preprocessor">
<h3><span class="section-number">7.1.1. </span>The Verilog preprocessor<a class="headerlink" href="#the-verilog-preprocessor" title="Permalink to this heading">¶</a></h3>
<p>The Verilog preprocessor scans over the Verilog source code and
interprets some of the Verilog compiler directives such as
<code class="docutils literal notranslate"><span class="pre">`include</span></code>, <code class="docutils literal notranslate"><span class="pre">`define</span></code> and <code class="docutils literal notranslate"><span class="pre">`ifdef</span></code>.</p>
<p>It is implemented as a C++ function that is passed a file descriptor as
input and returns the pre-processed Verilog code as a <code class="docutils literal notranslate"><span class="pre">std::string</span></code>.</p>
<p>The source code to the Verilog Preprocessor can be found in
frontends/verilog/preproc.cc in the Yosys source tree.</p>
</section>
<section id="the-verilog-lexer">
<h3><span class="section-number">7.1.2. </span>The Verilog lexer<a class="headerlink" href="#the-verilog-lexer" title="Permalink to this heading">¶</a></h3>
<p>The Verilog Lexer is written using the lexer generator flex . Its source
code can be found in frontends/verilog/verilog_lexer.l in the Yosys
source tree. The lexer does little more than identifying all keywords
and literals recognised by the Yosys Verilog frontend.</p>
<p>The lexer keeps track of the current location in the Verilog source code
using some global variables. These variables are used by the constructor
of AST nodes to annotate each node with the source code location it
originated from.</p>
<p>Finally the lexer identifies and handles special comments such as
“<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">synopsys</span> <span class="pre">translate_off</span></code>” and “<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">synopsys</span> <span class="pre">full_case</span></code>”. (It is
recommended to use <code class="docutils literal notranslate"><span class="pre">`ifdef</span></code> constructs instead of the
Synsopsys translate_on/off comments and attributes such as
<code class="docutils literal notranslate"><span class="pre">(*</span> <span class="pre">full_case</span> <span class="pre">*)</span></code> over “<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">synopsys</span> <span class="pre">full_case</span></code>” whenever possible.)</p>
</section>
<section id="the-verilog-parser">
<h3><span class="section-number">7.1.3. </span>The Verilog parser<a class="headerlink" href="#the-verilog-parser" title="Permalink to this heading">¶</a></h3>
<p>The Verilog Parser is written using the parser generator bison . Its
source code can be found in frontends/verilog/verilog_parser.y in the
Yosys source tree.</p>
<p>It generates an AST using the <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> data structure defined in
frontends/ast/ast.h. An <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> object has the following
properties:</p>
<table class="docutils align-default" id="tab-verilog-astnodetype">
<caption><span class="caption-number">Table 7.1 </span><span class="caption-text">AST node types with their corresponding Verilog constructs.</span><a class="headerlink" href="#tab-verilog-astnodetype" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>AST Node Type</p></td>
<td><p>Corresponding Verilog Construct</p></td>
</tr>
<tr class="row-even"><td><p>AST_NONE</p></td>
<td><p>This Node type should never be used.</p></td>
</tr>
<tr class="row-odd"><td><p>AST_DESIGN</p></td>
<td><p>This node type is used for the top node of the AST tree. It has no corresponding Verilog construct.</p></td>
</tr>
<tr class="row-even"><td><p>AST_MODULE, AST_TASK, AST_FUNCTION</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">module</span></code>, <code class="docutils literal notranslate"><span class="pre">task</span></code> and <code class="docutils literal notranslate"><span class="pre">function</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_WIRE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">output</span></code>, <code class="docutils literal notranslate"><span class="pre">wire</span></code>, <code class="docutils literal notranslate"><span class="pre">reg</span></code> and <code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
</tr>
<tr class="row-even"><td><p>AST_MEMORY</p></td>
<td><p>Verilog Arrays</p></td>
</tr>
<tr class="row-odd"><td><p>AST_AUTOWIRE</p></td>
<td><p>Created by the simplifier when an undeclared signal name is used.</p></td>
</tr>
<tr class="row-even"><td><p>AST_PARAMETER, AST_LOCALPARAM</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">parameter</span></code> and <code class="docutils literal notranslate"><span class="pre">localparam</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_PARASET</p></td>
<td><p>Parameter set in cell instantiation</p></td>
</tr>
<tr class="row-even"><td><p>AST_ARGUMENT</p></td>
<td><p>Port connection in cell instantiation</p></td>
</tr>
<tr class="row-odd"><td><p>AST_RANGE</p></td>
<td><p>Bit-Index in a signal or element index in array</p></td>
</tr>
<tr class="row-even"><td><p>AST_CONSTANT</p></td>
<td><p>A literal value</p></td>
</tr>
<tr class="row-odd"><td><p>AST_CELLTYPE</p></td>
<td><p>The type of cell in cell instantiation</p></td>
</tr>
<tr class="row-even"><td><p>AST_IDENTIFIER</p></td>
<td><p>An Identifier (signal name in expression or cell/task/etc. name in other contexts)</p></td>
</tr>
<tr class="row-odd"><td><p>AST_PREFIX</p></td>
<td><p>Construct an identifier in the form &lt;prefix&gt;[&lt;index&gt;].&lt;suffix&gt; (used only in advanced generate constructs)</p></td>
</tr>
<tr class="row-even"><td><p>AST_FCALL, AST_TCALL</p></td>
<td><p>Call to function or task</p></td>
</tr>
<tr class="row-odd"><td><p>AST_TO_SIGNED, AST_TO_UNSIGNED</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">$signed()</span></code> and <code class="docutils literal notranslate"><span class="pre">$unsigned()</span></code> functions</p></td>
</tr>
<tr class="row-even"><td><p>AST_CONCAT, AST_REPLICATE</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">{...}</span></code> and <code class="docutils literal notranslate"><span class="pre">{...{...}}</span></code> operators</p></td>
</tr>
<tr class="row-odd"><td><p>AST_BIT_NOT, AST_BIT_AND, AST_BIT_OR, AST_BIT_XOR, AST_BIT_XNOR</p></td>
<td><p>The bitwise operators <code class="docutils literal notranslate"><span class="pre">~</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">~^</span></code></p></td>
</tr>
<tr class="row-even"><td><p>AST_REDUCE_AND, AST_REDUCE_OR, AST_REDUCE_XOR, AST_REDUCE_XNOR</p></td>
<td><p>The unary reduction operators <code class="docutils literal notranslate"><span class="pre">~</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">~^</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_REDUCE_BOOL</p></td>
<td><p>Conversion from multi-bit value to boolean value (equivalent to AST_REDUCE_OR)</p></td>
</tr>
<tr class="row-even"><td><p>AST_SHIFT_LEFT, AST_SHIFT_RIGHT, AST_SHIFT_SLEFT, AST_SHIFT_SRIGHT</p></td>
<td><p>The shift operators <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_LT, AST_LE, AST_EQ, AST_NE, AST_GE, AST_GT</p></td>
<td><p>The relational operators <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>AST_ADD, AST_SUB, AST_MUL, AST_DIV, AST_MOD, AST_POW</p></td>
<td><p>The binary operators <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> and <code class="docutils literal notranslate"><span class="pre">**</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_POS, AST_NEG</p></td>
<td><p>The prefix operators <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
</tr>
<tr class="row-even"><td><p>AST_LOGIC_AND, AST_LOGIC_OR, AST_LOGIC_NOT</p></td>
<td><p>The logic operators <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">||</span></code> and <code class="docutils literal notranslate"><span class="pre">!</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>AST_TERNARY</p></td>
<td><p>The ternary <code class="docutils literal notranslate"><span class="pre">?:</span></code>-operator</p></td>
</tr>
<tr class="row-even"><td><p>AST_MEMRD AST_MEMWR</p></td>
<td><p>Read and write memories. These nodes are generated by the AST simplifier for writes/reads to/from Verilog arrays.</p></td>
</tr>
<tr class="row-odd"><td><p>AST_ASSIGN</p></td>
<td><p>An <code class="docutils literal notranslate"><span class="pre">assign</span></code> statement</p></td>
</tr>
<tr class="row-even"><td><p>AST_CELL</p></td>
<td><p>A cell instantiation</p></td>
</tr>
<tr class="row-odd"><td><p>AST_PRIMITIVE</p></td>
<td><p>A primitive cell (<code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">nand</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, etc.)</p></td>
</tr>
<tr class="row-even"><td><p>AST_ALWAYS, AST_INITIAL</p></td>
<td><p>Verilog <code class="docutils literal notranslate"><span class="pre">always</span></code>- and <code class="docutils literal notranslate"><span class="pre">initial</span></code>-blocks</p></td>
</tr>
<tr class="row-odd"><td><p>AST_BLOCK</p></td>
<td><p>A <code class="docutils literal notranslate"><span class="pre">begin</span></code>-<code class="docutils literal notranslate"><span class="pre">end</span></code>-block</p></td>
</tr>
<tr class="row-even"><td><p>AST_ASSIGN_EQ. AST_ASSIGN_LE</p></td>
<td><p>Blocking (<code class="docutils literal notranslate"><span class="pre">=</span></code>) and nonblocking (<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>) assignments within an <code class="docutils literal notranslate"><span class="pre">always</span></code>- or <code class="docutils literal notranslate"><span class="pre">initial</span></code>-block</p></td>
</tr>
<tr class="row-odd"><td><p>AST_CASE. AST_COND, AST_DEFAULT</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">case</span></code> (<code class="docutils literal notranslate"><span class="pre">if</span></code>) statements, conditions within a case and the default case respectively</p></td>
</tr>
<tr class="row-even"><td><p>AST_FOR</p></td>
<td><p>A <code class="docutils literal notranslate"><span class="pre">for</span></code>-loop with an <code class="docutils literal notranslate"><span class="pre">always</span></code>- or <code class="docutils literal notranslate"><span class="pre">initial</span></code>-block</p></td>
</tr>
<tr class="row-odd"><td><p>AST_GENVAR, AST_GENBLOCK, AST_GENFOR, AST_GENIF</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">genvar</span></code> and <code class="docutils literal notranslate"><span class="pre">generate</span></code> keywords and <code class="docutils literal notranslate"><span class="pre">for</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span></code> within a generate block.</p></td>
</tr>
<tr class="row-even"><td><p>AST_POSEDGE, AST_NEGEDGE, AST_EDGE</p></td>
<td><p>Event conditions for <code class="docutils literal notranslate"><span class="pre">always</span></code> blocks.</p></td>
</tr>
</tbody>
</table>
<ul>
<li><div class="line-block">
<div class="line">The node type</div>
<div class="line">This enum (<code class="docutils literal notranslate"><span class="pre">AST::AstNodeType</span></code>) specifies the role of the node.
<a class="reference internal" href="#tab-verilog-astnodetype"><span class="std std-numref">Table 7.1</span></a>
contains a list of all node types.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">The child nodes</div>
<div class="line">This is a list of pointers to all children in the abstract syntax
tree.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Attributes</div>
<div class="line">As almost every AST node might have Verilog attributes assigned to
it, the <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> has direct support for attributes. Note
that the attribute values are again AST nodes.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Node content</div>
<div class="line">Each node might have additional content data. A series of member
variables exist to hold such data. For example the member
<code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">str</span></code> can hold a string value and is used e.g. in the
AST_IDENTIFIER node type to store the identifier name.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Source code location</div>
<div class="line">Each <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> is automatically annotated with the current
source code location by the <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> constructor. It is
stored in the <code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">filename</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">linenum</span></code> member
variables.</div>
</div>
</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">AST::AstNode</span></code> constructor can be called with up to two child
nodes that are automatically added to the list of child nodes for the
new object. This simplifies the creation of AST nodes for simple
expressions a bit. For example the bison code for parsing
multiplications:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>basic_expr &#39;*&#39; attr basic_expr {
<span class="linenos">2</span>        $$ = new AstNode(AST_MUL, $1, $4);
<span class="linenos">3</span>        append_attr($$, $3);
<span class="linenos">4</span>} |
</pre></div>
</div>
<p>The generated AST data structure is then passed directly to the AST
frontend that performs the actual conversion to RTLIL.</p>
<p>Note that the Yosys command <code class="docutils literal notranslate"><span class="pre">read_verilog</span></code> provides the options <code class="docutils literal notranslate"><span class="pre">-yydebug</span></code>
and <code class="docutils literal notranslate"><span class="pre">-dump_ast</span></code> that can be used to print the parse tree or abstract
syntax tree respectively.</p>
</section>
</section>
<section id="transforming-ast-to-rtlil">
<h2><span class="section-number">7.2. </span>Transforming AST to RTLIL<a class="headerlink" href="#transforming-ast-to-rtlil" title="Permalink to this heading">¶</a></h2>
<p>The AST Frontend converts a set of modules in AST representation to
modules in RTLIL representation and adds them to the current design.
This is done in two steps: simplification and RTLIL generation.</p>
<p>The source code to the AST frontend can be found in <code class="docutils literal notranslate"><span class="pre">frontends/ast/</span></code> in
the Yosys source tree.</p>
<section id="ast-simplification">
<h3><span class="section-number">7.2.1. </span>AST simplification<a class="headerlink" href="#ast-simplification" title="Permalink to this heading">¶</a></h3>
<p>A full-featured AST is too complex to be transformed into RTLIL
directly. Therefore it must first be brought into a simpler form. This
is done by calling the <code class="docutils literal notranslate"><span class="pre">AST::AstNode::simplify()</span></code> method of all
AST_MODULE nodes in the AST. This initiates a recursive process that
performs the following transformations on the AST data structure:</p>
<ul class="simple">
<li><p>Inline all task and function calls.</p></li>
<li><p>Evaluate all <code class="docutils literal notranslate"><span class="pre">generate</span></code>-statements and unroll all <code class="docutils literal notranslate"><span class="pre">for</span></code>-loops.</p></li>
<li><p>Perform const folding where it is necessary (e.g. in the value part
of AST_PARAMETER, AST_LOCALPARAM, AST_PARASET and AST_RANGE nodes).</p></li>
<li><p>Replace AST_PRIMITIVE nodes with appropriate AST_ASSIGN nodes.</p></li>
<li><p>Replace dynamic bit ranges in the left-hand-side of assignments with
AST_CASE nodes with AST_COND children for each possible case.</p></li>
<li><p>Detect array access patterns that are too complicated for the
RTLIL::Memory abstraction and replace them with a set of signals and
cases for all reads and/or writes.</p></li>
<li><p>Otherwise replace array accesses with AST_MEMRD and AST_MEMWR nodes.</p></li>
</ul>
<p>In addition to these transformations, the simplifier also annotates the
AST with additional information that is needed for the RTLIL generator,
namely:</p>
<ul class="simple">
<li><p>All ranges (width of signals and bit selections) are not only const
folded but (when a constant value is found) are also written to
member variables in the AST_RANGE node.</p></li>
<li><p>All identifiers are resolved and all AST_IDENTIFIER nodes are
annotated with a pointer to the AST node that contains the
declaration of the identifier. If no declaration has been found, an
AST_AUTOWIRE node is created and used for the annotation.</p></li>
</ul>
<p>This produces an AST that is fairly easy to convert to the RTLIL format.</p>
</section>
<section id="generating-rtlil">
<h3><span class="section-number">7.2.2. </span>Generating RTLIL<a class="headerlink" href="#generating-rtlil" title="Permalink to this heading">¶</a></h3>
<p>After AST simplification, the <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> method of
each AST_MODULE node in the AST is called. This initiates a recursive
process that generates equivalent RTLIL data for the AST data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> method returns an <code class="docutils literal notranslate"><span class="pre">RTLIL::SigSpec</span></code>
structure. For nodes that represent expressions (operators, constants,
signals, etc.), the cells needed to implement the calculation described
by the expression are created and the resulting signal is returned. That
way it is easy to generate the circuits for large expressions using
depth-first recursion. For nodes that do not represent an expression
(such as AST_CELL), the corresponding circuit is generated and an empty
<code class="docutils literal notranslate"><span class="pre">RTLIL::SigSpec</span></code> is returned.</p>
</section>
</section>
<section id="synthesizing-verilog-always-blocks">
<h2><span class="section-number">7.3. </span>Synthesizing Verilog always blocks<a class="headerlink" href="#synthesizing-verilog-always-blocks" title="Permalink to this heading">¶</a></h2>
<p>For behavioural Verilog code (code utilizing <code class="docutils literal notranslate"><span class="pre">always</span></code>- and
<code class="docutils literal notranslate"><span class="pre">initial</span></code>-blocks) it is necessary to also generate <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code>
objects. This is done in the following way:</p>
<p>Whenever <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> encounters an <code class="docutils literal notranslate"><span class="pre">always</span></code>- or
<code class="docutils literal notranslate"><span class="pre">initial</span></code>-block, it creates an instance of
<code class="docutils literal notranslate"><span class="pre">AST_INTERNAL::ProcessGenerator</span></code>. This object then generates the
<code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code> object for the block. It also calls
<code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> for all right-hand-side expressions
contained within the block.</p>
<p>First the <code class="docutils literal notranslate"><span class="pre">AST_INTERNAL::ProcessGenerator</span></code> creates a list of all
signals assigned within the block. It then creates a set of temporary
signals using the naming scheme $&lt;number&gt; \&lt;original_name&gt; for each
of the assigned signals.</p>
<p>Then an <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code> is created that assigns all intermediate
values for each left-hand-side signal to the temporary signal in its
<code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree.</p>
<p>Finally a <code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code> is created for the <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code> that
assigns the temporary signals for the final values to the actual
signals.</p>
<p>A process may also contain memory writes. A <code class="docutils literal notranslate"><span class="pre">RTLIL::MemWriteAction</span></code> is
created for each of them.</p>
<p>Calls to <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> are generated for right hand sides
as needed. When blocking assignments are used,
<code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> is configured using global variables to use
the temporary signals that hold the correct intermediate values whenever
one of the previously assigned signals is used in an expression.</p>
<p>Unfortunately the generation of a correct
<code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree for behavioural code is a
non-trivial task. The AST frontend solves the problem using the approach
described on the following pages. The following example illustrates what
the algorithm is supposed to do. Consider the following Verilog code:</p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clock</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">    </span><span class="n">out1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in2</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">        </span><span class="n">out1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">out1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="n">out2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">out1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in3</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="n">out2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">out2</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in4</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="w">            </span><span class="n">out3</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">in6</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="linenos">12</span><span class="w">            </span><span class="n">out3</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">in7</span><span class="p">;</span><span class="w"></span>
<span class="linenos">13</span><span class="w">    </span><span class="n">out1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out1</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">out2</span><span class="p">;</span><span class="w"></span>
<span class="linenos">14</span><span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>This is translated by the Verilog and AST frontends into the following
RTLIL code (attributes, cell parameters and wire declarations not
included):</p>
<div class="highlight-RTLIL notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">cell</span><span class="w"> </span><span class="nf">$logic_not</span><span class="w"> </span><span class="nf">$logic_not$&lt;input&gt;:4$2</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">  </span><span class="k">connect</span><span class="w"> </span><span class="nv">\A</span><span class="w"> </span><span class="nv">\in1</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="k">connect</span><span class="w"> </span><span class="nv">\Y</span><span class="w"> </span><span class="nv">$logic_not$&lt;input&gt;:4$2_Y</span><span class="w"></span>
<span class="linenos"> 4</span><span class="k">end</span><span class="w"></span>
<span class="linenos"> 5</span><span class="k">cell</span><span class="w"> </span><span class="nf">$xor</span><span class="w"> </span><span class="nf">$xor$&lt;input&gt;:13$3</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">connect</span><span class="w"> </span><span class="nv">\A</span><span class="w"> </span><span class="nv">$1\out1[0:0]</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">connect</span><span class="w"> </span><span class="nv">\B</span><span class="w"> </span><span class="nv">\out2</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">  </span><span class="k">connect</span><span class="w"> </span><span class="nv">\Y</span><span class="w"> </span><span class="nv">$xor$&lt;input&gt;:13$3_Y</span><span class="w"></span>
<span class="linenos"> 9</span><span class="k">end</span><span class="w"></span>
<span class="linenos">10</span><span class="k">process</span><span class="w"> </span><span class="ni">$proc$&lt;input&gt;:1$1</span><span class="w"></span>
<span class="linenos">11</span><span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out3[0:0]</span><span class="w"> </span><span class="nv">\out3</span><span class="w"></span>
<span class="linenos">12</span><span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out2[0:0]</span><span class="w"> </span><span class="nv">$1\out1[0:0]</span><span class="w"></span>
<span class="linenos">13</span><span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out1[0:0]</span><span class="w"> </span><span class="nv">$xor$&lt;input&gt;:13$3_Y</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="nv">\in2</span><span class="w"></span>
<span class="linenos">15</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="m">1&#39;1</span><span class="w"></span>
<span class="linenos">16</span><span class="w">      </span><span class="k">assign</span><span class="w"> </span><span class="nv">$1\out1[0:0]</span><span class="w"> </span><span class="nv">$logic_not$&lt;input&gt;:4$2_Y</span><span class="w"></span>
<span class="linenos">17</span><span class="w">    </span><span class="k">case</span><span class="w"></span>
<span class="linenos">18</span><span class="w">      </span><span class="k">assign</span><span class="w"> </span><span class="nv">$1\out1[0:0]</span><span class="w"> </span><span class="nv">\in1</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="linenos">20</span><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="nv">\in3</span><span class="w"></span>
<span class="linenos">21</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="m">1&#39;1</span><span class="w"></span>
<span class="linenos">22</span><span class="w">      </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out2[0:0]</span><span class="w"> </span><span class="nv">\out2</span><span class="w"></span>
<span class="linenos">23</span><span class="w">    </span><span class="k">case</span><span class="w"></span>
<span class="linenos">24</span><span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="linenos">25</span><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="nv">\in4</span><span class="w"></span>
<span class="linenos">26</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="m">1&#39;1</span><span class="w"></span>
<span class="linenos">27</span><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="nv">\in5</span><span class="w"></span>
<span class="linenos">28</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="m">1&#39;1</span><span class="w"></span>
<span class="linenos">29</span><span class="w">          </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out3[0:0]</span><span class="w"> </span><span class="nv">\in6</span><span class="w"></span>
<span class="linenos">30</span><span class="w">        </span><span class="k">case</span><span class="w"></span>
<span class="linenos">31</span><span class="w">          </span><span class="k">assign</span><span class="w"> </span><span class="nv">$0\out3[0:0]</span><span class="w"> </span><span class="nv">\in7</span><span class="w"></span>
<span class="linenos">32</span><span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="linenos">33</span><span class="w">    </span><span class="k">case</span><span class="w"></span>
<span class="linenos">34</span><span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="linenos">35</span><span class="w">  </span><span class="k">sync</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="nv">\clock</span><span class="w"></span>
<span class="linenos">36</span><span class="w">    </span><span class="k">update</span><span class="w"> </span><span class="nv">\out1</span><span class="w"> </span><span class="nv">$0\out1[0:0]</span><span class="w"></span>
<span class="linenos">37</span><span class="w">    </span><span class="k">update</span><span class="w"> </span><span class="nv">\out2</span><span class="w"> </span><span class="nv">$0\out2[0:0]</span><span class="w"></span>
<span class="linenos">38</span><span class="w">    </span><span class="k">update</span><span class="w"> </span><span class="nv">\out3</span><span class="w"> </span><span class="nv">$0\out3[0:0]</span><span class="w"></span>
<span class="linenos">39</span><span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>Note that the two operators are translated into separate cells outside
the generated process. The signal <code class="docutils literal notranslate"><span class="pre">out1</span></code> is assigned using blocking
assignments and therefore <code class="docutils literal notranslate"><span class="pre">out1</span></code> has been replaced with a different
signal in all expressions after the initial assignment. The signal
<code class="docutils literal notranslate"><span class="pre">out2</span></code> is assigned using nonblocking assignments and therefore is not
substituted on the right-hand-side expressions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree must be interpreted
the following way:</p>
<ul>
<li><p>On each case level (the body of the process is the root case), first
the actions on this level are evaluated and then the switches within
the case are evaluated. (Note that the last assignment on line 13 of
the Verilog code has been moved to the beginning of the RTLIL process
to line 13 of the RTLIL listing.)</p>
<p>I.e. the special cases deeper in the switch hierarchy override the
defaults on the upper levels. The assignments in lines 12 and 22 of
the RTLIL code serve as an example for this.</p>
<p>Note that in contrast to this, the order within the
<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> objects within a <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code> is
preserved with respect to the original AST and Verilog code.</p>
</li>
<li><p>The whole <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree describes an
asynchronous circuit. I.e. the decision tree formed by the switches
can be seen independently for each assigned signal. Whenever one
assigned signal changes, all signals that depend on the changed
signals are to be updated. For example the assignments in lines 16
and 18 in the RTLIL code in fact influence the assignment in line 12,
even though they are in the “wrong order”.</p></li>
</ul>
<p>The only synchronous part of the process is in the <code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code>
object generated at line 35 in the RTLIL code. The sync rule is the only
part of the process where the original signals are assigned. The
synchronization event from the original Verilog code has been translated
into the synchronization type (posedge) and signal (\clock) for the
<code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code> object. In the case of this simple example the
<code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code> object is later simply transformed into a set of
d-type flip-flops and the <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree
to a decision tree using multiplexers.</p>
<p>In more complex examples (e.g. asynchronous resets) the part of the
<code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>/<code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> tree that describes the
asynchronous reset must first be transformed to the correct
<code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code> objects. This is done by the proc_adff pass.</p>
<section id="the-processgenerator-algorithm">
<h3><span class="section-number">7.3.1. </span>The ProcessGenerator algorithm<a class="headerlink" href="#the-processgenerator-algorithm" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">AST_INTERNAL::ProcessGenerator</span></code> uses the following internal state
variables:</p>
<ul>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code></div>
<div class="line">These two variables hold the replacement pattern that should be
used by <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> for signals with blocking
assignments. After initialization of
<code class="docutils literal notranslate"><span class="pre">AST_INTERNAL::ProcessGenerator</span></code> these two variables are empty.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code></div>
<div class="line">These two variables contain the mapping from left-hand-side signals
(\&lt;name&gt;) to the current temporary signal for the same thing
(initially $0\&lt;name&gt;).</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">current_case</span></code></div>
<div class="line">A pointer to a <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code> object. Initially this is the
root case of the generated <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code>.</div>
</div>
</li>
</ul>
<p>As the algorithm runs these variables are continuously modified as well
as pushed to the stack and later restored to their earlier values by
popping from the stack.</p>
<p>On startup the ProcessGenerator generates a new <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code>
object with an empty root case and initializes its state variables as
described above. Then the <code class="docutils literal notranslate"><span class="pre">RTLIL::SyncRule</span></code> objects are created using
the synchronization events from the AST_ALWAYS node and the initial
values of <code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code>. Then the AST
for this process is evaluated recursively.</p>
<p>During this recursive evaluation, three different relevant types of AST
nodes can be discovered: AST_ASSIGN_LE (nonblocking assignments),
AST_ASSIGN_EQ (blocking assignments) and AST_CASE (<code class="docutils literal notranslate"><span class="pre">if</span></code> or <code class="docutils literal notranslate"><span class="pre">case</span></code>
statement).</p>
<section id="handling-of-nonblocking-assignments">
<h4><span class="section-number">7.3.1.1. </span>Handling of nonblocking assignments<a class="headerlink" href="#handling-of-nonblocking-assignments" title="Permalink to this heading">¶</a></h4>
<p>When an AST_ASSIGN_LE node is discovered, the following actions are
performed by the ProcessGenerator:</p>
<ul class="simple">
<li><p>The left-hand-side is evaluated using <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code>
and mapped to a temporary signal name using <code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and
<code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code>.</p></li>
<li><p>The right-hand-side is evaluated using <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code>.
For this call, the values of <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code> are used to map blocking-assigned signals
correctly.</p></li>
<li><p>Remove all assignments to the same left-hand-side as this assignment
from the <code class="docutils literal notranslate"><span class="pre">current_case</span></code> and all cases within it.</p></li>
<li><p>Add the new assignment to the <code class="docutils literal notranslate"><span class="pre">current_case</span></code>.</p></li>
</ul>
</section>
<section id="handling-of-blocking-assignments">
<h4><span class="section-number">7.3.1.2. </span>Handling of blocking assignments<a class="headerlink" href="#handling-of-blocking-assignments" title="Permalink to this heading">¶</a></h4>
<p>When an AST_ASSIGN_EQ node is discovered, the following actions are
performed by the ProcessGenerator:</p>
<ul class="simple">
<li><p>Perform all the steps that would be performed for a nonblocking
assignment (see above).</p></li>
<li><p>Remove the found left-hand-side (before lvalue mapping) from
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and also remove the respective bits from
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>.</p></li>
<li><p>Append the found left-hand-side (before lvalue mapping) to
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and append the found right-hand-side to
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>.</p></li>
</ul>
</section>
<section id="handling-of-cases-and-if-statements">
<h4><span class="section-number">7.3.1.3. </span>Handling of cases and if-statements<a class="headerlink" href="#handling-of-cases-and-if-statements" title="Permalink to this heading">¶</a></h4>
<p>When an AST_CASE node is discovered, the following actions are performed
by the ProcessGenerator:</p>
<ul class="simple">
<li><p>The values of <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>, <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>,
<code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code> are pushed to the
stack.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> object is generated, the selection
expression is evaluated using <code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> (with the
use of <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>) and added to
the <code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> object and the object is added to the
<code class="docutils literal notranslate"><span class="pre">current_case</span></code>.</p></li>
<li><p>All lvalues assigned to within the AST_CASE node using blocking
assignments are collected and saved in the local variable
<code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code>.</p></li>
<li><p>New temporary signals are generated for all signals in
<code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> and stored in <code class="docutils literal notranslate"><span class="pre">this_case_eq_ltemp</span></code>.</p></li>
<li><p>The signals in <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> are mapped using
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code> and the resulting set
of signals is stored in <code class="docutils literal notranslate"><span class="pre">this_case_eq_rvalue</span></code>.</p></li>
</ul>
<p>Then the following steps are performed for each AST_COND node within the
AST_CASE node:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>, <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>, <code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code>
and <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code> to the values that have been pushed to the
stack.</p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> from
<code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code>/<code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code>.</p></li>
<li><p>Append <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> to <code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and append
<code class="docutils literal notranslate"><span class="pre">this_case_eq_ltemp</span></code> to <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code>.</p></li>
<li><p>Push the value of <code class="docutils literal notranslate"><span class="pre">current_case</span></code>.</p></li>
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code>. Set <code class="docutils literal notranslate"><span class="pre">current_case</span></code> to the new
object and add the new object to the <code class="docutils literal notranslate"><span class="pre">RTLIL::SwitchRule</span></code> created
above.</p></li>
<li><p>Add an assignment from <code class="docutils literal notranslate"><span class="pre">this_case_eq_rvalue</span></code> to
<code class="docutils literal notranslate"><span class="pre">this_case_eq_ltemp</span></code> to the new <code class="docutils literal notranslate"><span class="pre">current_case</span></code>.</p></li>
<li><p>Evaluate the compare value for this case using
<code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> (with the use of <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>
and <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>) modify the new <code class="docutils literal notranslate"><span class="pre">current_case</span></code> accordingly.</p></li>
<li><p>Recursion into the children of the AST_COND node.</p></li>
<li><p>Restore <code class="docutils literal notranslate"><span class="pre">current_case</span></code> by popping the old value from the stack.</p></li>
</ul>
<p>Finally the following steps are performed:</p>
<ul class="simple">
<li><p>The values of <code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>, <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>,
<code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code> and <code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code> are popped from the
stack.</p></li>
<li><p>The signals from <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> are removed from the
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>/<code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>-pair.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> is appended to
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code> and the value of <code class="docutils literal notranslate"><span class="pre">this_case_eq_ltemp</span></code> is
appended to <code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>.</p></li>
<li><p>Map the signals in <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> using
<code class="docutils literal notranslate"><span class="pre">subst_lvalue_from</span></code>/<code class="docutils literal notranslate"><span class="pre">subst_lvalue_to</span></code>.</p></li>
<li><p>Remove all assignments to signals in <code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> in
<code class="docutils literal notranslate"><span class="pre">current_case</span></code> and all cases within it.</p></li>
<li><p>Add an assignment from <code class="docutils literal notranslate"><span class="pre">this_case_eq_ltemp</span></code> to
<code class="docutils literal notranslate"><span class="pre">this_case_eq_lvalue</span></code> to <code class="docutils literal notranslate"><span class="pre">current_case</span></code>.</p></li>
</ul>
</section>
<section id="further-analysis-of-the-algorithm-for-cases-and-if-statements">
<h4><span class="section-number">7.3.1.4. </span>Further analysis of the algorithm for cases and if-statements<a class="headerlink" href="#further-analysis-of-the-algorithm-for-cases-and-if-statements" title="Permalink to this heading">¶</a></h4>
<p>With respect to nonblocking assignments the algorithm is easy: later
assignments invalidate earlier assignments. For each signal assigned
using nonblocking assignments exactly one temporary variable is
generated (with the $0-prefix) and this variable is used for all
assignments of the variable.</p>
<p>Note how all the <code class="docutils literal notranslate"><span class="pre">_eq_</span></code>-variables become empty when no blocking
assignments are used and many of the steps in the algorithm can then be
ignored as a result of this.</p>
<p>For a variable with blocking assignments the algorithm shows the
following behaviour: First a new temporary variable is created. This new
temporary variable is then registered as the assignment target for all
assignments for this variable within the cases for this AST_CASE node.
Then for each case the new temporary variable is first assigned the old
temporary variable. This assignment is overwritten if the variable is
actually assigned in this case and is kept as a default value otherwise.</p>
<p>This yields an <code class="docutils literal notranslate"><span class="pre">RTLIL::CaseRule</span></code> that assigns the new temporary
variable in all branches. So when all cases have been processed a final
assignment is added to the containing block that assigns the new
temporary variable to the old one. Note how this step always overrides a
previous assignment to the old temporary variable. Other than
nonblocking assignments, the old assignment could still have an effect
somewhere in the design, as there have been calls to
<code class="docutils literal notranslate"><span class="pre">AST::AstNode::genRTLIL()</span></code> with a
<code class="docutils literal notranslate"><span class="pre">subst_rvalue_from</span></code>/<code class="docutils literal notranslate"><span class="pre">subst_rvalue_to</span></code>-tuple that contained the
right-hand-side of the old assignment.</p>
</section>
</section>
<section id="the-proc-pass">
<h3><span class="section-number">7.3.2. </span>The proc pass<a class="headerlink" href="#the-proc-pass" title="Permalink to this heading">¶</a></h3>
<p>The ProcessGenerator converts a behavioural model in AST representation
to a behavioural model in <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code> representation. The actual
conversion from a behavioural model to an RTL representation is
performed by the proc pass and the passes it launches:</p>
<ul>
<li><div class="line-block">
<div class="line">proc_clean and proc_rmdead</div>
<div class="line">These two passes just clean up the <code class="docutils literal notranslate"><span class="pre">RTLIL::Process</span></code> structure.
The proc_clean pass removes empty parts (eg. empty assignments)
from the process and proc_rmdead detects and removes unreachable
branches from the process’s decision trees.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">proc_arst</div>
<div class="line">This pass detects processes that describe d-type flip-flops with
asynchronous resets and rewrites the process to better reflect what
they are modelling: Before this pass, an asynchronous reset has two
edge-sensitive sync rules and one top-level for the reset path.
After this pass the sync rule for the reset is level-sensitive and
the top-level has been removed.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">proc_mux</div>
<div class="line">This pass converts the /-tree to a tree of multiplexers per written
signal. After this, the structure only contains the s that describe
the output registers.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">proc_dff</div>
<div class="line">This pass replaces the s to d-type flip-flops (with asynchronous
resets if necessary).</div>
</div>
</li>
<li><div class="line-block">
<div class="line">proc_dff</div>
<div class="line">This pass replaces the s with $memwr cells.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">proc_clean</div>
<div class="line">A final call to proc_clean removes the now empty objects.</div>
</div>
</li>
</ul>
<p>Performing these last processing steps in passes instead of in the
Verilog frontend has two important benefits:</p>
<p>First it improves the transparency of the process. Everything that
happens in a separate pass is easier to debug, as the RTLIL data
structures can be easily investigated before and after each of the
steps.</p>
<p>Second it improves flexibility. This scheme can easily be extended to
support other types of storage-elements, such as sr-latches or
d-latches, without having to extend the actual Verilog frontend.</p>
</section>
</section>
<section id="synthesizing-verilog-arrays">
<h2><span class="section-number">7.4. </span>Synthesizing Verilog arrays<a class="headerlink" href="#synthesizing-verilog-arrays" title="Permalink to this heading">¶</a></h2>
<p>Add some information on the generation of $memrd and $memwr cells and
how they are processed in the memory pass.</p>
</section>
<section id="synthesizing-parametric-designs">
<h2><span class="section-number">7.5. </span>Synthesizing parametric designs<a class="headerlink" href="#synthesizing-parametric-designs" title="Permalink to this heading">¶</a></h2>
<p>Add some information on the <code class="docutils literal notranslate"><span class="pre">RTLIL::Module::derive()</span></code> method and how
it is used to synthesize parametric modules via the hierarchy pass.</p>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="CHAPTER_Prog.html"
       title="previous chapter">← <span class="section-number">6. </span>Programming Yosys extensions</a>
  </li>
  <li class="next">
    <a href="CHAPTER_Optimize.html"
       title="next chapter"><span class="section-number">8. </span>Optimizations →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2022 YosysHQ GmbH.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>